{
  "datasourceConfig": {
    "description": "灵活的数据源配置，支持动态选择和环境适配",
    "options": [
      {
        "name": "grafana-clickhouse-datasource",
        "uid": "fexr755u22ku8b",
        "type": "grafana-clickhouse-datasource",
        "description": "默认ClickHouse数据源"
      },
      {
        "name": "${DS_CLICKHOUSE}",
        "uid": "${DS_CLICKHOUSE}",
        "type": "grafana-clickhouse-datasource",
        "description": "模板变量形式，支持环境切换"
      }
    ],
    "recommended": "${DS_CLICKHOUSE}"
  },
  "tableSchema": {
    "mainTable": "nginx_analytics.dwd_nginx_enriched_v3",
    "keyFields": {
      "timeColumn": "log_time",
      "dateColumn": "date_partition",
      "tenantColumn": "tenant_code",
      "platformColumn": "platform",
      "apiCategoryColumn": "api_category",
      "businessDomainColumn": "business_domain",
      "responseStatusColumn": "response_status_code",
      "requestDurationColumn": "total_request_duration"
    },
    "permissionFields": {
      "tenant_code": "LowCardinality(String)",
      "team_code": "LowCardinality(String)",
      "environment": "LowCardinality(String)",
      "data_sensitivity": "Enum8"
    }
  },
  "commonVariables": {
    "tenant_code": {
      "type": "query",
      "query": "SELECT DISTINCT tenant_code FROM nginx_analytics.dwd_nginx_enriched_v3 ORDER BY tenant_code",
      "current": "default_tenant",
      "includeAll": true,
      "multi": true
    },
    "platform": {
      "type": "query",
      "query": "SELECT DISTINCT platform FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE tenant_code IN ($tenant_code) ORDER BY platform",
      "current": "All",
      "includeAll": true,
      "multi": true
    },
    "api_category": {
      "type": "query",
      "query": "SELECT DISTINCT api_category FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE tenant_code IN ($tenant_code) AND platform IN ($platform) ORDER BY api_category",
      "current": "All",
      "includeAll": true,
      "multi": true
    },
    "business_domain": {
      "type": "query",
      "query": "SELECT DISTINCT business_domain FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE tenant_code IN ($tenant_code) ORDER BY business_domain",
      "current": "All",
      "includeAll": true,
      "multi": true
    }
  },
  "macroExamples": {
    "timeFilter": "$__timeFilter(log_time)",
    "timeFilter_ms": "$__timeFilter_ms(log_time)",
    "dateFilter": "$__dateFilter(date_partition)",
    "interval": "$__timeInterval(log_time)",
    "fromTime": "$__fromTime",
    "toTime": "$__toTime",
    "conditionalAll": "$__conditionalAll(platform = '$platform', $platform)"
  },
  "commonQueries": {
    "requestVolume": "SELECT $__timeInterval(log_time) as time, count(*) as requests FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE $__timeFilter(log_time) AND $__conditionalAll(tenant_code IN ($tenant_code), $tenant_code) AND $__conditionalAll(platform IN ($platform), $platform) GROUP BY time ORDER BY time",
    "avgResponseTime": "SELECT $__timeInterval(log_time) as time, avg(total_request_duration) as avg_time FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE $__timeFilter(log_time) AND $__conditionalAll(tenant_code IN ($tenant_code), $tenant_code) GROUP BY time ORDER BY time",
    "errorRate": "SELECT $__timeInterval(log_time) as time, countIf(is_error = 1) * 100.0 / count(*) as error_rate FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE $__timeFilter(log_time) AND $__conditionalAll(tenant_code IN ($tenant_code), $tenant_code) GROUP BY time ORDER BY time",
    "topAPIs": "SELECT api_category, count(*) as requests, avg(total_request_duration) as avg_time FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE $__timeFilter(log_time) AND $__conditionalAll(tenant_code IN ($tenant_code), $tenant_code) GROUP BY api_category ORDER BY requests DESC LIMIT 10",
    "statusCodeDistribution": "SELECT response_status_code, count(*) as count FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE $__timeFilter(log_time) AND $__conditionalAll(tenant_code IN ($tenant_code), $tenant_code) GROUP BY response_status_code ORDER BY count DESC"
  },
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "grafana-clickhouse-datasource",
          "value": "fexr755u22ku8b"
        },
        "hide": 0,
        "includeAll": false,
        "label": "数据源",
        "multi": false,
        "name": "DS_CLICKHOUSE",
        "options": [],
        "query": "grafana-clickhouse-datasource",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      },
      {
        "current": {
          "selected": true,
          "text": [
            "All"
          ],
          "value": [
            "$__all"
          ]
        },
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "${DS_CLICKHOUSE}"
        },
        "definition": "SELECT DISTINCT tenant_code FROM nginx_analytics.dwd_nginx_enriched_v3 ORDER BY tenant_code",
        "hide": 0,
        "includeAll": true,
        "label": "租户",
        "multi": true,
        "name": "tenant_code",
        "options": [],
        "query": "SELECT DISTINCT tenant_code FROM nginx_analytics.dwd_nginx_enriched_v3 ORDER BY tenant_code",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {
          "selected": true,
          "text": [
            "All"
          ],
          "value": [
            "$__all"
          ]
        },
        "datasource": {
          "type": "grafana-clickhouse-datasource",
          "uid": "${DS_CLICKHOUSE}"
        },
        "definition": "SELECT DISTINCT platform FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE $__conditionalAll(tenant_code IN ($tenant_code), $tenant_code) ORDER BY platform",
        "hide": 0,
        "includeAll": true,
        "label": "平台",
        "multi": true,
        "name": "platform",
        "options": [],
        "query": "SELECT DISTINCT platform FROM nginx_analytics.dwd_nginx_enriched_v3 WHERE $__conditionalAll(tenant_code IN ($tenant_code), $tenant_code) ORDER BY platform",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      }
    ]
  },
  "uid": "dashboard-template-config"
}