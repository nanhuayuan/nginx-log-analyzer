# 建议的Nginx日志格式配置
# 添加到nginx.conf的http块中

log_format json_analytics escape=json '{'
    '"time": "$time_iso8601",'
    '"remote_addr": "$remote_addr",'
    '"http_host": "$http_host",'
    '"request_method": "$request_method",'
    '"request_uri": "$uri",'
    '"request_args": "$args",'
    '"request_protocol": "$server_protocol",'
    '"status": "$status",'
    '"response_time": "$request_time",'
    '"upstream_time": "$upstream_response_time",'
    '"body_bytes_sent": "$body_bytes_sent",'
    '"http_referer": "$http_referer",'
    '"http_user_agent": "$http_user_agent",'
    '"http_x_forwarded_for": "$http_x_forwarded_for",'
    '"trace_id": "$http_x_trace_id",'
    '"request_id": "$request_id"'
'}';

# 在server块中使用
access_log /var/log/nginx/access.log json_analytics;

# 或者使用简化的底座格式（当前系统支持的格式）
log_format base_format '$http_host:$http_host '
                       'remote_addr:"$remote_addr" '
                       'time:"$time_iso8601" '
                       'request:"$request" '
                       'status:"$status" '
                       'response_time:"$request_time" '
                       'upstream_response_time:"$upstream_response_time" '
                       'body_bytes_sent:"$body_bytes_sent" '
                       'http_referer:"$http_referer" '
                       'http_user_agent:"$http_user_agent"';

access_log /var/log/nginx/access.log base_format;
