# Service Analyzer Bugä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°

åœ¨è¿è¡Œ`self_02_service_analyzer_advanced.py`æ—¶å‡ºç°KeyErroré”™è¯¯ï¼š

```
KeyError: 'å¹³å‡è¯·æ±‚æ—¶é•¿(ç§’)'
```

**é”™è¯¯ä½ç½®**: `generate_service_results()` å‡½æ•°ç¬¬479è¡Œ

## é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
åˆ—åä¸åŒ¹é…é—®é¢˜ï¼š
1. åœ¨`_build_service_result()`ä¸­ç”Ÿæˆçš„åˆ—åæ˜¯ï¼š`å¹³å‡è¯·æ±‚æ€»æ—¶é•¿(ç§’)`
2. åœ¨`generate_service_results()`ä¸­æ’åºä½¿ç”¨çš„åˆ—åæ˜¯ï¼š`å¹³å‡è¯·æ±‚æ—¶é•¿(ç§’)`
3. ä¸¤ä¸ªåˆ—åä¸åŒ¹é…å¯¼è‡´KeyError

### é—®é¢˜èŒƒå›´
1. æœåŠ¡ç»“æœç”Ÿæˆå‡½æ•° (`generate_service_results`)
2. åº”ç”¨ç»“æœç”Ÿæˆå‡½æ•° (`generate_app_results`)
3. è¡¨å¤´åˆ†ç»„å‡½æ•° (`create_service_header_groups`)

## ä¿®å¤æ–¹æ¡ˆ

### 1. æ™ºèƒ½æ’åºæœºåˆ¶
å°†ç¡¬ç¼–ç çš„åˆ—åæ’åºæ”¹ä¸ºæ™ºèƒ½æ’åºï¼š

```python
# ä¿®å¤å‰
return df.sort_values('å¹³å‡è¯·æ±‚æ—¶é•¿(ç§’)', ascending=False)

# ä¿®å¤å
sort_columns = ['å¹³å‡è¯·æ±‚æ€»æ—¶é•¿(ç§’)', 'å¹³å‡åç«¯å“åº”æ—¶é•¿(ç§’)', 'å¹³å‡åç«¯å¤„ç†é˜¶æ®µ(ç§’)', 'æˆåŠŸè¯·æ±‚æ•°']
sort_column = None

for col in sort_columns:
    if col in df.columns:
        sort_column = col
        break

if sort_column:
    return df.sort_values(sort_column, ascending=False)
else:
    return df
```

### 2. è¡¨å¤´åˆ†ç»„ä¿®å¤
ä¿®å¤è¡¨å¤´åˆ†ç»„ä¸­çš„åˆ—åä¸åŒ¹é…ï¼š

```python
# ä¿®å¤å‰
'å“åº”æ—¶é—´åˆ†æ(ç§’)': ['å¹³å‡', 'P50', 'P95', 'P99'],

# ä¿®å¤å
'å“åº”æ—¶é—´åˆ†æ(ç§’)': ['å¹³å‡è¯·æ±‚æ€»æ—¶é•¿(ç§’)', 'P50è¯·æ±‚æ€»æ—¶é•¿(ç§’)', 'P95è¯·æ±‚æ€»æ—¶é•¿(ç§’)', 'P99è¯·æ±‚æ€»æ—¶é•¿(ç§’)'],
```

## ä¿®å¤è¯¦æƒ…

### æ–‡ä»¶ä¿®æ”¹
- **æ–‡ä»¶**: `self_02_service_analyzer_advanced.py`
- **ä¿®æ”¹è¡Œæ•°**: 479, 666, 850-853
- **ä¿®æ”¹ç±»å‹**: é€»è¾‘ä¿®å¤ï¼Œåˆ—åå¯¹é½

### ä¿®å¤å†…å®¹

#### 1. æœåŠ¡ç»“æœç”Ÿæˆå‡½æ•°ä¿®å¤
```python
def generate_service_results(self):
    """ç”ŸæˆæœåŠ¡åˆ†æç»“æœ"""
    # ... å…¶ä»–ä»£ç  ...
    
    # æ™ºèƒ½æ’åº - ä¼˜å…ˆä½¿ç”¨è¯·æ±‚æ€»æ—¶é•¿ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨å…¶ä»–æ—¶é—´æŒ‡æ ‡
    sort_columns = ['å¹³å‡è¯·æ±‚æ€»æ—¶é•¿(ç§’)', 'å¹³å‡åç«¯å“åº”æ—¶é•¿(ç§’)', 'å¹³å‡åç«¯å¤„ç†é˜¶æ®µ(ç§’)', 'æˆåŠŸè¯·æ±‚æ•°']
    sort_column = None
    
    for col in sort_columns:
        if col in df.columns:
            sort_column = col
            break
    
    if sort_column:
        return df.sort_values(sort_column, ascending=False)
    else:
        return df
```

#### 2. åº”ç”¨ç»“æœç”Ÿæˆå‡½æ•°ä¿®å¤
```python
def generate_app_results(self):
    """ç”Ÿæˆåº”ç”¨åˆ†æç»“æœ"""
    # ... å…¶ä»–ä»£ç  ...
    
    # æ™ºèƒ½æ’åº - ä¼˜å…ˆä½¿ç”¨è¯·æ±‚æ—¶é•¿ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨å…¶ä»–æŒ‡æ ‡
    sort_columns = ['å¹³å‡è¯·æ±‚æ—¶é•¿(ç§’)', 'P95è¯·æ±‚æ—¶é•¿(ç§’)', 'æˆåŠŸè¯·æ±‚æ•°']
    sort_column = None
    
    for col in sort_columns:
        if col in df.columns:
            sort_column = col
            break
    
    if sort_column:
        return df.sort_values(sort_column, ascending=False)
    else:
        return df
```

#### 3. è¡¨å¤´åˆ†ç»„ä¿®å¤
```python
def create_service_header_groups():
    """åˆ›å»ºæœåŠ¡åˆ†æè¡¨å¤´åˆ†ç»„"""
    return {
        'åŸºæœ¬ä¿¡æ¯': ['æœåŠ¡åç§°', 'åº”ç”¨åç§°'],
        'è¯·æ±‚ç»Ÿè®¡': ['æ¥å£è¯·æ±‚æ€»æ•°', 'æˆåŠŸè¯·æ±‚æ•°', 'é”™è¯¯è¯·æ±‚æ•°', 'å æ€»è¯·æ±‚æ¯”ä¾‹(%)', 'æˆåŠŸç‡(%)', 'é¢‘ç‡ä¼°è®¡'],
        'æ€§èƒ½æŒ‡æ ‡': ['æ…¢è¯·æ±‚æ•°', 'æ…¢è¯·æ±‚å æ¯”(%)', 'å¼‚å¸¸è¯·æ±‚æ•°'],
        'å“åº”æ—¶é—´åˆ†æ(ç§’)': ['å¹³å‡è¯·æ±‚æ€»æ—¶é•¿(ç§’)', 'P50è¯·æ±‚æ€»æ—¶é•¿(ç§’)', 'P95è¯·æ±‚æ€»æ—¶é•¿(ç§’)', 'P99è¯·æ±‚æ€»æ—¶é•¿(ç§’)'],
        'åç«¯æ€§èƒ½(ç§’)': ['å¹³å‡åç«¯å“åº”æ—¶é•¿(ç§’)', 'P50åç«¯å“åº”æ—¶é•¿(ç§’)', 'P95åç«¯å“åº”æ—¶é•¿(ç§’)', 'P99åç«¯å“åº”æ—¶é•¿(ç§’)'],
        'å¤„ç†æ€§èƒ½(ç§’)': ['å¹³å‡åç«¯å¤„ç†é˜¶æ®µ(ç§’)', 'P50åç«¯å¤„ç†é˜¶æ®µ(ç§’)', 'P95åç«¯å¤„ç†é˜¶æ®µ(ç§’)', 'P99åç«¯å¤„ç†é˜¶æ®µ(ç§’)'],
        'å¤§å°ç»Ÿè®¡(KB)': ['å¹³å‡å“åº”ä½“å¤§å°(KB)', 'P95å“åº”ä½“å¤§å°(KB)', 'å¹³å‡æ€»å‘é€å­—èŠ‚(KB)', 'P95æ€»å‘é€å­—èŠ‚(KB)'],
        'æ•ˆç‡æŒ‡æ ‡': ['å“åº”ä¼ è¾“é€Ÿåº¦(KB/s)', 'è¿æ¥æˆæœ¬å æ¯”(%)', 'å¤„ç†ä¸»å¯¼åº¦(%)', 'æœåŠ¡ç¨³å®šæ€§è¯„åˆ†'],
        'å¥åº·è¯„åˆ†': ['æœåŠ¡å¥åº·è¯„åˆ†']
    }
```

## ä¿®å¤éªŒè¯

### éªŒè¯æ–¹æ³•
1. å¯¼å…¥æ¨¡å—æµ‹è¯•
2. åˆ›å»ºåˆ†æå™¨å®ä¾‹
3. ç”Ÿæˆç©ºç»“æœæµ‹è¯•
4. è¡¨å¤´åˆ†ç»„æµ‹è¯•

### é¢„æœŸç»“æœ
- âœ… ä¸å†å‡ºç°KeyError
- âœ… æ’åºåŠŸèƒ½æ­£å¸¸
- âœ… è¡¨å¤´åˆ†ç»„åˆ—ååŒ¹é…
- âœ… å‘åå…¼å®¹æ€§ä¿æŒ

## å½±å“è¯„ä¼°

### æ­£é¢å½±å“
- ä¿®å¤äº†è¿è¡Œæ—¶é”™è¯¯
- æé«˜äº†ä»£ç å¥å£®æ€§
- å¢åŠ äº†æ™ºèƒ½æ’åºåŠŸèƒ½

### é£é™©è¯„ä¼°
- **é£é™©çº§åˆ«**: ä½
- **å‘åå…¼å®¹**: ä¿æŒ
- **åŠŸèƒ½å½±å“**: æ— è´Ÿé¢å½±å“

## æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•
```python
def test_service_analyzer_fix():
    analyzer = AdvancedServiceAnalyzer()
    
    # æµ‹è¯•ç©ºç»“æœç”Ÿæˆ
    service_results = analyzer.generate_service_results()
    assert isinstance(service_results, pd.DataFrame)
    
    # æµ‹è¯•è¡¨å¤´åˆ†ç»„
    headers = create_service_header_groups()
    assert 'å“åº”æ—¶é—´åˆ†æ(ç§’)' in headers
```

### é›†æˆæµ‹è¯•
```python
def test_full_analysis():
    # ä½¿ç”¨çœŸå®æ•°æ®æµ‹è¯•å®Œæ•´åˆ†ææµç¨‹
    results = analyze_service_performance_advanced(
        "test_data.csv", 
        "test_output.xlsx"
    )
    assert not results.empty
```

## éƒ¨ç½²å»ºè®®

1. **ç«‹å³éƒ¨ç½²**: è¿™æ˜¯ä¸€ä¸ªå…³é”®bugä¿®å¤ï¼Œå»ºè®®ç«‹å³éƒ¨ç½²
2. **å›å½’æµ‹è¯•**: éƒ¨ç½²åè¿›è¡Œå›å½’æµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸
3. **ç›‘æ§**: éƒ¨ç½²åç›‘æ§æ˜¯å¦è¿˜æœ‰å…¶ä»–KeyErroré—®é¢˜

## åç»­ä¼˜åŒ–

### ä»£ç è´¨é‡æå‡
1. æ·»åŠ åˆ—åéªŒè¯æœºåˆ¶
2. å¢åŠ æ›´å¤šçš„å¼‚å¸¸å¤„ç†
3. æ·»åŠ å•å…ƒæµ‹è¯•è¦†ç›–

### è®¾è®¡æ”¹è¿›
1. ç»Ÿä¸€åˆ—åå‘½åè§„èŒƒ
2. ä½¿ç”¨å¸¸é‡å®šä¹‰åˆ—å
3. æ·»åŠ åˆ—åæ˜ å°„é…ç½®

---

**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: âš ï¸ å¾…numpyç¯å¢ƒæµ‹è¯•  
**éƒ¨ç½²çŠ¶æ€**: ğŸ”„ å‡†å¤‡éƒ¨ç½²  

**ä¿®å¤æ—¶é—´**: 2025-07-18  
**ä¿®å¤äººå‘˜**: Claude Code